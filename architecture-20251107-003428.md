# üèóÔ∏è System Architecture
## Web3News - Blockchain Content Aggregator

**Created:** 2025-11-07  
**Design Agent:** System Architect  
**Status:** ‚úÖ Complete  
**Next Agent:** Data Agent (`/data`)

---

## üìê ARCHITECTURE DIAGRAM

### High-Level Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CLIENT-SIDE PWA                          ‚îÇ
‚îÇ                  (Next.js 14 Static Export)                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ  ‚îÇ   Frontend   ‚îÇ  ‚îÇ   State      ‚îÇ  ‚îÇ   Content    ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ   (React)    ‚îÇ‚Üí ‚îÇ   Management ‚îÇ‚Üí ‚îÇ   Service    ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ   (Zustand)  ‚îÇ  ‚îÇ   (Fetch)    ‚îÇ     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ         ‚îÇ                 ‚îÇ                    ‚îÇ            ‚îÇ
‚îÇ         ‚îÇ                 ‚îÇ                    ‚îÇ            ‚îÇ
‚îÇ         ‚ñº                 ‚ñº                    ‚ñº            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ  ‚îÇ   IndexedDB  ‚îÇ  ‚îÇ   Reown      ‚îÇ  ‚îÇ   Clerk      ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ   (Cache)    ‚îÇ  ‚îÇ   AppKit     ‚îÇ  ‚îÇ   (Auth)     ‚îÇ     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ         ‚îÇ                 ‚îÇ                    ‚îÇ            ‚îÇ
‚îÇ         ‚îÇ                 ‚îÇ                    ‚îÇ            ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                            ‚îÇ                                ‚îÇ
‚îÇ                            ‚ñº                                ‚îÇ
‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                          ‚îÇ
‚îÇ                   ‚îÇ   Supabase   ‚îÇ                          ‚îÇ
‚îÇ                   ‚îÇ  (Database)  ‚îÇ                          ‚îÇ
‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                          ‚îÇ
‚îÇ                            ‚îÇ                                ‚îÇ
‚îÇ                            ‚ñº                                ‚îÇ
‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ              ‚îÇ   External APIs          ‚îÇ                   ‚îÇ
‚îÇ              ‚îÇ   (30+ Sources)          ‚îÇ                   ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ                            ‚îÇ                                ‚îÇ
‚îÇ                            ‚ñº                                ‚îÇ
‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ              ‚îÇ   Blockchain            ‚îÇ                   ‚îÇ
‚îÇ              ‚îÇ   (6 Chains √ó 3 Contracts)                  ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ COMPONENT ARCHITECTURE

### Frontend Layer (Next.js 14 App Router)

**Structure:**
```
app/
‚îú‚îÄ‚îÄ layout.tsx                    # Root layout (providers)
‚îú‚îÄ‚îÄ page.tsx                      # Homepage
‚îú‚îÄ‚îÄ (auth)/
‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx              # Login page
‚îÇ   ‚îî‚îÄ‚îÄ verify/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx               # Email verification
‚îú‚îÄ‚îÄ (feed)/
‚îÇ   ‚îú‚îÄ‚îÄ feed/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx               # Content feed
‚îÇ   ‚îú‚îÄ‚îÄ article/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx           # Article reader view
‚îÇ   ‚îî‚îÄ‚îÄ search/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx               # Search & discovery
‚îú‚îÄ‚îÄ (web3)/
‚îÇ   ‚îú‚îÄ‚îÄ auctions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx               # Auction list
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx           # Auction detail
‚îÇ   ‚îú‚îÄ‚îÄ points/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx               # Points dashboard
‚îÇ   ‚îî‚îÄ‚îÄ governance/
‚îÇ       ‚îú‚îÄ‚îÄ page.tsx               # Proposal list
‚îÇ       ‚îî‚îÄ‚îÄ [id]/
‚îÇ           ‚îî‚îÄ‚îÄ page.tsx           # Proposal detail
‚îî‚îÄ‚îÄ (social)/
    ‚îú‚îÄ‚îÄ profile/
    ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx               # User profile
    ‚îÇ   ‚îî‚îÄ‚îÄ settings/
    ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx           # Settings
    ‚îú‚îÄ‚îÄ messages/
    ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx               # Message list
    ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
    ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx           # Conversation
    ‚îî‚îÄ‚îÄ lists/
        ‚îú‚îÄ‚îÄ page.tsx               # Lists
        ‚îî‚îÄ‚îÄ [id]/
            ‚îî‚îÄ‚îÄ page.tsx           # List detail
```

**Key Files:**
- `app/layout.tsx` - Root layout with providers (Reown, Clerk, React Query, Zustand)
- `app/providers.tsx` - Provider wrapper (client component)
- `components/` - Reusable React components
- `lib/` - Utility functions, API wrappers
- `stores/` - Zustand stores
- `hooks/` - Custom React hooks

---

### State Management Architecture

**Zustand Stores (Global State):**

**`stores/authStore.ts`**
```typescript
interface AuthState {
  isConnected: boolean;
  account: string | null;
  chainId: number | null;
  clerkUser: User | null;
  setAccount: (account: string) => void;
  setChainId: (chainId: number) => void;
  setClerkUser: (user: User) => void;
}
```

**`stores/userStore.ts`**
```typescript
interface UserState {
  preferences: UserPreferences;
  pointsBalance: number;
  subscriptionTier: 'free' | 'pro' | 'premium';
  setPreferences: (prefs: UserPreferences) => void;
  setPointsBalance: (balance: number) => void;
}
```

**`stores/uiStore.ts`**
```typescript
interface UIState {
  theme: 'dark' | 'light' | 'system';
  sidebarOpen: boolean;
  modalOpen: boolean;
  setTheme: (theme: string) => void;
  toggleSidebar: () => void;
  openModal: (modal: string) => void;
}
```

**React Query (Server State):**

**`hooks/useArticles.ts`**
```typescript
export function useArticles(category: string) {
  return useQuery({
    queryKey: ['articles', category],
    queryFn: () => fetchArticles(category),
    staleTime: 30 * 60 * 1000, // 30 minutes
    cacheTime: 60 * 60 * 1000, // 1 hour
  });
}
```

**`hooks/useArticle.ts`**
```typescript
export function useArticle(url: string) {
  return useQuery({
    queryKey: ['article', url],
    queryFn: () => fetchArticleContent(url),
    staleTime: 30 * 60 * 1000,
  });
}
```

---

### Content Aggregation Architecture

**Service: `lib/services/contentAggregator.ts`**

```typescript
class ContentAggregator {
  private cache: IndexedDBCache;
  private rateLimiter: RateLimiter;

  async aggregateSources(sources: string[]): Promise<Article[]> {
    // Parallel fetching
    const promises = sources.map(source => this.fetchSource(source));
    const results = await Promise.allSettled(promises);
    
    // Deduplication
    const articles = this.deduplicate(results);
    
    // Caching
    await this.cache.setArticles(articles);
    
    return articles;
  }

  private async fetchSource(source: string): Promise<Article[]> {
    // Rate limiting
    await this.rateLimiter.wait(source);
    
    // Fetch from source
    const articles = await this.fetchFromSource(source);
    
    return articles;
  }

  private deduplicate(articles: Article[]): Article[] {
    const seen = new Set<string>();
    return articles.filter(article => {
      const hash = this.hashUrl(article.url);
      if (seen.has(hash)) return false;
      seen.add(hash);
      return true;
    });
  }
}
```

**Sources:**
- Hacker News: Firebase API
- Product Hunt: GraphQL API
- GitHub: REST API
- Reddit: JSON endpoints
- Medium: RSS feeds
- Crypto news: RSS feeds
- Price APIs: CoinGecko, CryptoCompare, etc.

---

### IndexedDB Cache Architecture

**Service: `lib/services/indexedDBCache.ts`**

```typescript
import localforage from 'localforage';

class IndexedDBCache {
  private articlesStore: LocalForage;
  private bookmarksStore: LocalForage;
  private preferencesStore: LocalForage;
  private offlineQueueStore: LocalForage;

  constructor() {
    this.articlesStore = localforage.createInstance({
      name: 'web3news',
      storeName: 'articles',
    });
    // ... other stores
  }

  async getArticle(url: string): Promise<Article | null> {
    const article = await this.articlesStore.getItem<Article>(url);
    if (!article) return null;
    
    // Check TTL (30 minutes)
    const age = Date.now() - article.cachedAt;
    if (age > 30 * 60 * 1000) {
      await this.articlesStore.removeItem(url);
      return null;
    }
    
    return article;
  }

  async setArticle(article: Article): Promise<void> {
    article.cachedAt = Date.now();
    await this.articlesStore.setItem(article.url, article);
    
    // Cleanup old articles (keep last 2,000)
    await this.cleanupOldArticles();
  }

  private async cleanupOldArticles(): Promise<void> {
    const keys = await this.articlesStore.keys();
    if (keys.length > 2000) {
      // Remove oldest articles
      const sorted = await this.getSortedByAge();
      const toRemove = sorted.slice(2000);
      await Promise.all(toRemove.map(key => this.articlesStore.removeItem(key)));
    }
  }
}
```

---

### Authentication Architecture

**Flow:**
1. User clicks login ‚Üí Reown modal opens
2. User selects social login ‚Üí Reown authenticates
3. Reown creates ERC-4337 smart account (automatic)
4. Clerk user created in background (via webhook or client-side)
5. Email verification sent (Clerk magic link)
6. User verified ‚Üí Full access granted

**Implementation: `lib/services/authService.ts`**

```typescript
import { useAppKit } from '@reown/appkit/react';
import { useUser, useClerk } from '@clerk/nextjs';

export function useAuth() {
  const { address, isConnected } = useAppKit();
  const { user, isSignedIn } = useUser();
  const clerk = useClerk();

  const login = async (provider: 'google' | 'twitter' | 'email') => {
    // 1. Connect Reown wallet
    await connectWallet(provider);
    
    // 2. Create Clerk user (background)
    if (!isSignedIn) {
      await clerk.signIn.create({ strategy: provider });
    }
    
    // 3. Link wallet address to Clerk metadata
    await clerk.user.update({
      unsafeMetadata: {
        wallet_address: address,
      },
    });
  };

  return { address, user, isConnected, isSignedIn, login };
}
```

---

### Smart Contract Integration Architecture

**Service: `lib/services/contractService.ts`**

```typescript
import { useContractWrite, useContractRead } from 'wagmi';
import { AdPaymentContractABI } from '@/abis/AdPaymentContract';

export function useAdAuction(auctionId: string) {
  const { data: auction } = useContractRead({
    address: AD_PAYMENT_CONTRACT_ADDRESS,
    abi: AdPaymentContractABI,
    functionName: 'getAuction',
    args: [auctionId],
  });

  const { write: joinAuction } = useContractWrite({
    address: AD_PAYMENT_CONTRACT_ADDRESS,
    abi: AdPaymentContractABI,
    functionName: 'joinAuction',
    args: [auctionId],
  });

  const { write: placeBid } = useContractWrite({
    address: AD_PAYMENT_CONTRACT_ADDRESS,
    abi: AdPaymentContractABI,
    functionName: 'placeBid',
    args: [auctionId],
  });

  return { auction, joinAuction, placeBid };
}
```

**Contract Addresses (6 chains):**
- Ethereum: `0x...`
- Polygon: `0x...`
- BSC: `0x...`
- Arbitrum: `0x...`
- Optimism: `0x...`
- Base: `0x...`

---

### PWA Service Worker Architecture

**Service Worker: `public/sw.js`**

```javascript
const CACHE_NAME = 'web3news-v1';
const STATIC_CACHE = 'web3news-static-v1';
const ARTICLE_CACHE = 'web3news-articles-v1';

// Install: Cache static assets
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(STATIC_CACHE).then((cache) => {
      return cache.addAll([
        '/',
        '/manifest.json',
        '/icon.png',
        // ... other static assets
      ]);
    })
  );
});

// Fetch: Cache-first for static, network-first for articles
self.addEventListener('fetch', (event) => {
  const url = new URL(event.request.url);
  
  // Static assets: Cache-first
  if (url.pathname.startsWith('/_next/static/')) {
    event.respondWith(cacheFirst(event.request));
    return;
  }
  
  // Articles: Network-first, cache fallback
  if (url.pathname.startsWith('/article/')) {
    event.respondWith(networkFirst(event.request));
    return;
  }
  
  // Default: Network-only
  event.respondWith(fetch(event.request));
});

async function cacheFirst(request) {
  const cached = await caches.match(request);
  if (cached) return cached;
  const response = await fetch(request);
  const cache = await caches.open(STATIC_CACHE);
  cache.put(request, response.clone());
  return response;
}

async function networkFirst(request) {
  try {
    const response = await fetch(request);
    const cache = await caches.open(ARTICLE_CACHE);
    cache.put(request, response.clone());
    return response;
  } catch (error) {
    const cached = await caches.match(request);
    if (cached) return cached;
    throw error;
  }
}
```

---

## üîÑ DATA FLOW ARCHITECTURE

### Content Aggregation Flow

```
[User Opens Feed]
    ‚Üì
[Check IndexedDB Cache]
    ‚îú‚îÄ Cache Hit (Valid) ‚Üí [Return Cached Articles]
    ‚îî‚îÄ Cache Miss/Expired ‚Üí [Fetch from Sources]
            ‚Üì
    [Parallel Fetching]
    ‚îú‚îÄ Hacker News API
    ‚îú‚îÄ Product Hunt API
    ‚îú‚îÄ GitHub API
    ‚îú‚îÄ Reddit API
    ‚îî‚îÄ RSS Feeds
            ‚Üì
    [Deduplication]
            ‚Üì
    [Cache in IndexedDB]
            ‚Üì
    [Display Articles]
```

### Authentication Flow

```
[User Clicks Login]
    ‚Üì
[Reown Modal Opens]
    ‚Üì
[User Selects Social Login]
    ‚Üì
[Reown Authenticates]
    ‚Üì
[ERC-4337 Smart Account Created]
    ‚Üì
[Clerk User Created (Background)]
    ‚îú‚îÄ Webhook: POST /api/webhooks/clerk
    ‚îî‚îÄ Or Client-Side: clerk.signIn.create()
            ‚Üì
    [Wallet Address Linked to Clerk Metadata]
            ‚Üì
    [Email Verification Sent]
            ‚Üì
    [User Verified]
            ‚Üì
    [Full Access Granted]
```

### Ad Auction Flow

```
[User Views Auction]
    ‚Üì
[Check USDT Balance]
    ‚îú‚îÄ Insufficient ‚Üí [Show Top-Up Option]
    ‚îî‚îÄ Sufficient ‚Üí [Show Bid Form]
            ‚Üì
    [User Enters Bid Amount]
            ‚Üì
    [Validate Bid (5%+ increment)]
            ‚Üì
    [Pay Participation Fee (1 USDT)]
            ‚Üì
    [Place Bid (Smart Contract)]
            ‚Üì
    [Transaction Confirmed]
            ‚Üì
    [Update UI (Bid Placed)]
            ‚Üì
    [Track Status (Win/Lose)]
```

---

## üé® COMPONENT ARCHITECTURE

### Component Hierarchy

```
App
‚îú‚îÄ‚îÄ Providers (Reown, Clerk, React Query, Zustand)
‚îÇ   ‚îî‚îÄ‚îÄ Layout
‚îÇ       ‚îú‚îÄ‚îÄ Header
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Logo
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ SearchBar
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ProfileButton
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ NotificationsBadge
‚îÇ       ‚îú‚îÄ‚îÄ Main Content
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CategoryTabs
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ArticleFeed
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ArticleCard[]
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ InfiniteScroll
‚îÇ       ‚îî‚îÄ‚îÄ BottomNav
‚îÇ           ‚îú‚îÄ‚îÄ HomeButton
‚îÇ           ‚îú‚îÄ‚îÄ SearchButton
‚îÇ           ‚îú‚îÄ‚îÄ BookmarksButton
‚îÇ           ‚îî‚îÄ‚îÄ ProfileButton
‚îî‚îÄ‚îÄ Modals
    ‚îú‚îÄ‚îÄ AuthModal (Reown)
    ‚îú‚îÄ‚îÄ ReaderModal
    ‚îî‚îÄ‚îÄ BidModal
```

### Component Specifications

**`components/ArticleCard.tsx`**
```typescript
interface ArticleCardProps {
  article: Article;
  onUpvote: (articleId: string) => void;
  onBookmark: (articleId: string) => void;
  onShare: (articleId: string) => void;
}

export function ArticleCard({ article, onUpvote, onBookmark, onShare }: ArticleCardProps) {
  const { upvoteArticle } = useArticleActions();
  const { isBookmarked } = useBookmarks();
  
  return (
    <div className="article-card">
      <img src={article.thumbnail} alt={article.title} />
      <h3>{article.title}</h3>
      <p>{article.source} ‚Ä¢ {formatTime(article.publishedAt)}</p>
      <div className="actions">
        <button onClick={() => onUpvote(article.id)}>
          üëç {article.upvotes}
        </button>
        <button onClick={() => onBookmark(article.id)}>
          {isBookmarked(article.id) ? 'üîñ' : 'üîñ'}
        </button>
        <button onClick={() => onShare(article.id)}>üì§</button>
      </div>
    </div>
  );
}
```

**`components/SearchBar.tsx`**
```typescript
interface SearchBarProps {
  onSearch: (query: string) => void;
  autocomplete?: boolean;
}

export function SearchBar({ onSearch, autocomplete = true }: SearchBarProps) {
  const [query, setQuery] = useState('');
  const { data: suggestions } = useQuery({
    queryKey: ['search-suggestions', query],
    queryFn: () => getSearchSuggestions(query),
    enabled: autocomplete && query.length > 2,
  });
  
  return (
    <div className="search-bar">
      <input
        type="text"
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder="Search articles..."
      />
      {suggestions && (
        <div className="autocomplete">
          {suggestions.map(suggestion => (
            <div key={suggestion.id} onClick={() => onSearch(suggestion.query)}>
              {suggestion.query}
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
```

---

## üîê SECURITY ARCHITECTURE

### Client-Side Security

**Content Security Policy (CSP):**
```
default-src 'self';
script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.reown.com;
style-src 'self' 'unsafe-inline';
img-src 'self' data: https:;
connect-src 'self' https://*.supabase.co https://*.reown.com https://api.*;
```

**Row Level Security (RLS):**
- Users can only read/write their own data
- Public read access for articles, proposals
- Authenticated write access for submissions, votes

**Rate Limiting:**
- Client-side: 10 requests/minute per source
- IndexedDB tracking: Store request timestamps
- Exponential backoff: On errors

---

## ‚ö° PERFORMANCE ARCHITECTURE

### Caching Strategy

**IndexedDB:**
- Articles: 30-min TTL, 2,000 limit
- Auto-cleanup: Remove expired entries
- Size limit: 50 MB (iOS Safari), unlimited (other browsers)

**Service Worker:**
- Static assets: Cache-first
- Articles: Network-first, cache fallback
- Background sync: When online

**React Query:**
- Server state: 30-min TTL
- Automatic refetch: On window focus
- Background updates: Stale-while-revalidate

### Code Splitting

**Next.js Dynamic Imports:**
```typescript
// Lazy load heavy components
const ReaderView = dynamic(() => import('@/components/ReaderView'), {
  loading: () => <Skeleton />,
});

const AuctionDetail = dynamic(() => import('@/components/AuctionDetail'), {
  loading: () => <Skeleton />,
});
```

**Route-Based Splitting:**
- Each route gets its own bundle
- Shared chunks for common code
- Optimized bundle sizes

---

## ‚úÖ ARCHITECTURE COMPLETE

**Status:** ‚úÖ System Architecture Complete  
**Next:** Database Schema and API Specifications  
**Next Agent:** Data Agent (`/data`) - After design approval

**Total Components:** 10 system components  
**Architecture Type:** Client-Side PWA (Static Site Generation)  
**Modern Patterns:** Next.js 14 App Router, Zustand, React Query, IndexedDB

